---
title: "CAD Larp FISH"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(cowplot)
```

## Round 1!
### RPL7 and its mutant were siRNA transfected and dox induced at the same time (day -4) 48hr following, cells were plated on glass and media was swapped for -FBS (day -2). cells were prepped for imaging 2 days later.


```{r, all spot tidy data}
all_spot_cad <- as_tibble(read.csv("21.06.21_CADlarpFISH/results/_FISH-QUANT__all_spots_210622.txt", header = TRUE, skip = 13, sep = "\t"))

all_spot_cad2 <- as_tibble(read.csv("21.06.23_CADLarpFISH/Results/_FISH-QUANT__all_spots_210701.txt", header = TRUE, skip = 13, sep = "\t"))

all_spot_cad <- rbind(all_spot_cad, all_spot_cad2) %>% separate(File, into = c("CAD", "gene", "siRNA", "image","stack"), sep = "_") %>%  mutate(cell = as.numeric(substr(Cell, 6, 6)), cell = ifelse(cell %% 2 == 0, "neurite", "soma"), image = substr(image,1,2)) %>% select(gene,siRNA, image, cell, everything(), -stack) 

```

```{r, all spot filter}
all_spot_cad %>% select(gene,siRNA,cell, SigmaX, SigmaZ, BGD, Pos_Z) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free", nrow =2) + theme_cowplot()

#only Int_raw is different
all_spot_cad  %>% select(gene,siRNA,cell, SigmaX, SigmaZ, AMP, INT_filt, INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free",nrow = 2) + theme_cowplot() + ylim(0,2000)

##a closer look with each condition.
all_spot_cad %>% select(gene,siRNA, cell,INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + ylim(1000,3500) + facet_grid(.~cell) + geom_hline(yintercept = 1500)

all_spot_cad %>% select(gene,siRNA,cell,BGD) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha =0.5) + theme_cowplot() + ylim(200,900) + facet_grid(.~cell) + geom_hline(yintercept = 775)

all_spot_cad %>% select(gene,siRNA,cell,SigmaX) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot()  + facet_grid(.~cell) + geom_hline(yintercept = 200)

all_spot_cad %>% select(gene,siRNA,cell,SigmaZ) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + facet_grid(.~cell) + geom_hline(yintercept = 500)


#really limits spots.
CAD_filt <- all_spot_cad %>% filter(as.numeric(INT_raw) > 1450, as.numeric(INT_raw) < 3000 ) #, as.numeric(BGD) > 750, as.numeric(Pos_Z) > 450, as.numeric(Pos_Z) < 10000)
```

```{r, }
CAD_filt %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% ggplot(aes(x = siRNA, y = numspots, fill = cell)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3)

CAD_filt %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% spread(cell,numspots) %>% mutate(totspots = neurite + soma) %>% filter(siRNA != "none") %>% ggplot(aes(x = siRNA, y = totspots, fill = siRNA)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + ylab("Total Spots") + guides(fill = FALSE) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + EnvStats::stat_n_text(y.pos = -50)

CAD_filt %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA == "NC1") %>% ggplot(aes(x = gene, y = numspots)) + geom_violin(aes(fill = gene, alpha = gene)) + geom_boxplot(aes(fill = gene, alpha = gene), outlier.shape = NA, width = 0.2) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"),c("RPL7", "RPL7mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~siRNA) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040")) + scale_alpha_manual(values = c(1,1,0.5))

CAD_filt %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(siRNA != "none", cell == "soma") %>% ggplot(aes(x = siRNA, y = numspots, fill = siRNA)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE) + EnvStats::stat_n_text(y.pos = -5) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7"))

CADfilt_summary <- CAD_filt %>% 
  group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene, siRNA,image, cell,Cell, N_thres_Total) %>% 
  group_by(gene,siRNA,image,Cell) %>% 
  mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>% 
  spread(key = cell, value = N_thres_Total) %>%
  mutate(neurite = ifelse(is.na(neurite), 0, neurite)) %>% 
  mutate(n_s_thresh = neurite/soma) %>% 
  select(gene, image, n_s_thresh) %>% 
  ungroup() %>% left_join(., CAD_filt %>% group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene,siRNA, image, cell, N_thres_Total)) 

CADfilt_summary %>% select(-N_thres_Total) %>% unique() %>% filter(siRNA == "NC1") %>% ggplot(aes(x = gene, y = n_s_thresh))  + geom_violin(aes(fill = gene, alpha = gene)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"),c("RPL7", "RPL7mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~siRNA) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040")) + scale_alpha_manual(values = c(1,1,0.5))

CADfilt_summary %>% select(-N_thres_Total) %>% unique() %>% filter(siRNA != "none") %>% ggplot(aes(x = siRNA, y = n_s_thresh))  + geom_violin(aes(fill = siRNA)) + geom_boxplot(aes(fill = siRNA),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~gene, nrow = 3, scales = "free_y") + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7"))


```


## Round 2!
## This time a little different... 
### RPS28 and its mutant were dox induced on day -4 for 48hr. Cells were siRNA transfected, plated on glass and media was swapped for -FBS (day -2). cells were prepped for imaging 2 days later.


```{r, all spot tidy data28}
all_spot_cad28 <- as_tibble(read.csv("21.07.01_CADLarpFISH28/Results/_FISH-QUANT__all_spots_210702.txt", header = TRUE, skip = 13, sep = "\t"))

##fix names
CapStr <- function(y) {
  c <- strsplit(y, " ")[[1]]
  paste(toupper(substring(c, 1,1)), tolower(substring(c, 2)),
      sep="", collapse=" ")
}


all_spot_cad28 <- all_spot_cad28 %>% separate(File, into = c("CAD", "gene", "siRNA", "image","stack"), sep = "_") %>%  mutate(cell = as.numeric(substr(Cell, 6, 6)), cell = ifelse(cell %% 2 == 0, "neurite", "soma"), image = substr(image,1,2)) %>% select(gene,siRNA, image, cell, everything(), -stack) %>% rowwise() %>%  mutate(siRNA = ifelse(siRNA == "NC1" | siRNA == "none",siRNA, CapStr(siRNA)))

```

```{r, all spot filter28}
all_spot_cad28 %>% select(gene,siRNA,cell, SigmaX, SigmaZ, BGD, Pos_Z) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free", nrow =2) + theme_cowplot()

#only Int_raw is different
all_spot_cad28 %>% select(gene,siRNA,cell, SigmaX, SigmaZ, AMP, INT_filt, INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free",nrow = 2) + theme_cowplot() + ylim(0,2000)

##a closer look with each condition.
all_spot_cad28 %>% select(gene,siRNA, cell,INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + ylim(1000,3500) + facet_grid(.~cell) + geom_hline(yintercept = 1500)

all_spot_cad28 %>% select(gene,siRNA,cell,BGD) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha =0.5) + theme_cowplot() + ylim(200,900) + facet_grid(.~cell) + geom_hline(yintercept = 775)

all_spot_cad28 %>% select(gene,siRNA,cell,SigmaX) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot()  + facet_grid(.~cell) + geom_hline(yintercept = 200)

all_spot_cad28 %>% select(gene,siRNA,cell,SigmaZ) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + facet_grid(.~cell) + geom_hline(yintercept = 500)


#really limits spots.
CAD_filt28 <- all_spot_cad28 %>% filter(as.numeric(INT_filt) > 1500, as.numeric(INT_raw) < 4000 ) #, as.numeric(BGD) > 750, as.numeric(Pos_Z) > 450, as.numeric(Pos_Z) < 10000)
```

```{r, }
CAD_filt28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% ggplot(aes(x = siRNA, y = numspots, fill = cell)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3)

CAD_filt28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% spread(cell,numspots) %>% mutate(totspots = neurite + soma) %>% ggplot(aes(x = siRNA, y = totspots, fill = siRNA)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb"), c("none", "Larp1"), c("none", "Larp4"),c("none", "Larp7"), c("none", "Ssb")), method = "wilcox.test") + ylab("Total Spots") + guides(fill = FALSE)  + EnvStats::stat_n_text(y.pos = -50) + scale_x_discrete(limits = c("NC1", "none", "Ssb", "Larp1", "Larp4", "Larp7"))

CAD_filt28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA == "NC1"| siRNA == "none") %>%  unite(col = sample,gene,siRNA,sep = "_") %>% ggplot(aes(x = sample, y = numspots, fill = sample, alpha = sample)) + geom_violin() + geom_boxplot(width = 0.2, outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("RPS28_NC1", "RPS28mut_none")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#b82080", "#b82080")) + scale_alpha_manual(values = c(1,0.5))

CAD_filt28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma") %>% ggplot(aes(x = siRNA, y = numspots, fill = siRNA)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb"), c("none", "Larp1"), c("none", "Larp4"),c("none", "Larp7"), c("none", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE) + EnvStats::stat_n_text(y.pos = -5) + facet_wrap(.~gene, nrow = 3) #+ scale_x_discrete(limits = c("NC1", "none", "Ssb", "Larp1", "Larp4", "Larp7")) 

CADfilt28_summary <- CAD_filt28 %>% 
  group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene, siRNA,image, cell,Cell, N_thres_Total) %>% 
  group_by(gene,siRNA,image,Cell) %>% 
  mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>% 
  spread(key = cell, value = N_thres_Total) %>%
  mutate(neurite = ifelse(is.na(neurite), 0, neurite)) %>% 
  mutate(n_s_thresh = neurite/soma) %>% 
  select(gene, image, n_s_thresh) %>% 
  ungroup() %>% left_join(., CAD_filt28 %>% group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene,siRNA, image, cell, N_thres_Total))

CADfilt28_summary %>% select(-N_thres_Total) %>% unique() %>% filter(siRNA == "NC1"| siRNA == "none") %>%  unite(col = sample,gene,siRNA,sep = "_") %>% ggplot(aes(x = sample, y = n_s_thresh))  + geom_violin(aes(fill = sample, alpha = sample)) + geom_boxplot(aes(fill = sample, alpha= sample),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("RPS28_NC1", "RPS28mut_none")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE)  + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#b82080", "#b82080")) + scale_alpha_manual(values = c(1,0.5))

CADfilt28_summary %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh))  + geom_violin(aes(fill = siRNA)) + geom_boxplot(aes(fill = siRNA),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb"), c("none", "Larp1"), c("none", "Larp4"), c("none", "Larp7"), c("none", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~gene, nrow = 3, scales = "free_y")


```

## Round 3!
## back to being like Round 1... 
### RPS28 and its mutant were siRNA transfected and dox induced at the same time (day -4) 48hr following, cells were plated on glass and media was swapped for -FBS (day -2). cells were prepped for imaging 2 days later.


```{r, }
spot_28_1 <- as_tibble(read.csv("21.07.15_CAD28LarpFish-4d/Results/_FISH-QUANT__all_spots_210715.txt", header = TRUE, skip = 13, sep = "\t"))

spot_28_2 <- as_tibble(read.csv("21.07.15_CAD28LarpFish-4d/Results/_FISH-QUANT__all_spots_210716.txt", header = TRUE, skip = 13, sep = "\t"))


all_spot_28 <- rbind(spot_28_1, spot_28_2) %>% separate(File, into = c("CAD", "gene", "siRNA", "image","stack"), sep = "_") %>%  mutate(cell = as.numeric(substr(Cell, 6, 6)), cell = ifelse(cell %% 2 == 0, "neurite", "soma"), image = substr(image,1,2)) %>% select(gene,siRNA, image, cell, everything(), -stack)

```

```{r, }
all_spot_28 %>% select(gene,siRNA,cell, SigmaX, SigmaZ, BGD, Pos_Z) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free", nrow =2) + theme_cowplot()

#only Int_raw is different
all_spot_28 %>% select(gene,siRNA,cell, SigmaX, SigmaZ, AMP, INT_filt, INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + facet_wrap(cell~param, scales = "free",nrow = 2) + theme_cowplot() + ylim(0,2000)

##a closer look with each condition.
all_spot_28 %>% select(gene,siRNA, cell,INT_raw) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + ylim(1000,3500) + facet_grid(.~cell) + geom_hline(yintercept = 1500)

all_spot_28 %>% select(gene,siRNA,cell,BGD) %>% gather(-gene,-siRNA,-cell, key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha =0.5) + theme_cowplot() + ylim(200,900) + facet_grid(.~cell) + geom_hline(yintercept = 775)

all_spot_28 %>% select(gene,siRNA,cell,SigmaX) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot()  + facet_grid(.~cell) + geom_hline(yintercept = 150)

all_spot_28 %>% select(gene,siRNA,cell,SigmaZ) %>% gather(-gene,-siRNA,-cell,key = "param", value = "value") %>% mutate(value = as.numeric(value)) %>% ggplot(aes(y=value, group = gene, fill = gene)) + geom_density(alpha = 0.5) + theme_cowplot() + facet_grid(.~cell) + geom_hline(yintercept = 450)


#really limits spots.

filt_spot_28 <- all_spot_28 %>% filter(as.numeric(INT_raw) > 1500, as.numeric(INT_filt) < 4000, as.numeric(BGD) < 775, as.numeric(SigmaZ) < 450, as.numeric(SigmaX) < 150)#, as.numeric(Pos_Z) > 450, as.numeric(Pos_Z) < 10000)
```

```{r, }
filt_spot_28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% ggplot(aes(x = siRNA, y = numspots, fill = cell)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3)

filt_spot_28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% spread(cell,numspots) %>% mutate(totspots = neurite + soma) %>% ggplot(aes(x = siRNA, y = totspots, fill = siRNA)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 3) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + ylab("Total Spots") + guides(fill = FALSE)  + EnvStats::stat_n_text(y.pos = -50) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7"))

filt_spot_28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell)%>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA == "NC1") %>% ggplot(aes(x = gene, y = numspots, fill = gene, alpha = gene)) + geom_violin() + geom_boxplot(width = 0.2, outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#808080","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5))

filt_spot_28 %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma") %>% ggplot(aes(x = siRNA, y = numspots, fill = siRNA)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE) + EnvStats::stat_n_text(y.pos = -5) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) 

filt_spot_summary <- filt_spot_28 %>% 
  group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene, siRNA,image, cell,Cell, N_thres_Total) %>% 
  group_by(gene,siRNA,image,Cell) %>% 
  mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>% 
  spread(key = cell, value = N_thres_Total) %>%
  mutate(neurite = ifelse(is.na(neurite), 0, neurite)) %>% 
  mutate(n_s_thresh = neurite/soma) %>% 
  select(gene, image, n_s_thresh) %>% 
  ungroup() %>% left_join(., filt_spot_28 %>% group_by(gene,siRNA,image,cell,Cell) %>% summarize(N_thres_Total = n()) %>% ungroup() %>% select(gene,siRNA, image, cell, N_thres_Total))

filt_spot_summary %>% select(-N_thres_Total) %>% unique() %>% filter(siRNA == "NC1")  %>% ggplot(aes(x = gene, y = n_s_thresh))  + geom_violin(aes(fill = gene, alpha = gene)) + geom_boxplot(aes(fill = gene, alpha= gene),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("RPS28", "RPS28mut"),c("FF", "RPS28"),c("FF","RPS28mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE)  + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#808080","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5))

filt_spot_summary %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh))  + geom_violin(aes(fill = siRNA)) + geom_boxplot(aes(fill = siRNA),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.1) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) 


```


## Round 1 + Round 3!!!

```{r, }
rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(siRNA != "none") %>% ggplot(aes(x = siRNA, y = numspots, fill = cell)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 5) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) 

rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% spread(cell,numspots) %>% mutate(totspots = neurite + soma) %>% ggplot(aes(x = siRNA, y = totspots, fill = siRNA)) + geom_boxplot() + theme_cowplot() + facet_wrap(.~gene, nrow = 5) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7"), c("NC1", "Ssb")), method = "wilcox.test") + labs(y = "Total Spots", x = "") + guides(fill = FALSE) + EnvStats::stat_n_text(y.pos = -50) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7"))

rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA == "NC1") %>% ggplot(aes(x = gene, y = numspots, fill = gene, alpha = gene)) + geom_violin() + geom_boxplot(width = 0.2, outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5))

rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma") %>% ggplot(aes(x = siRNA, y = numspots, fill = siRNA)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"), c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")), label.y = c(100,110,120,130), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE) + EnvStats::stat_n_text(y.pos = -5) + facet_wrap(.~factor(gene, levels = c("RPL7", "RPL7mut", "RPS28", "RPS28mut", "FF")), nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) 

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(siRNA == "NC1")  %>% ggplot(aes(x = gene, y = n_s_thresh))  + geom_violin(aes(fill = gene, alpha = gene)) + geom_boxplot(aes(fill = gene, alpha= gene),outlier.shape = NA, width = 0.1) + geom_point(alpha = 0.25, position = "jitter") + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE)  + guides(fill = FALSE, alpha = FALSE)  + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5))

###plot for figure

rbind(CADfilt_summary, filt_spot_summary) %>% filter(!(gene == "RPL7mut" & siRNA == "NC1" & image == "01")) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma") %>% ggplot(aes(x = siRNA, y = n_s_thresh))  + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA, width = 0.5) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")),label.y = c(0.25,0.3,0.35,0.4), method = "wilcox.test", label = "p.signif", size = 7, vjust = 0.5, hide.ns = TRUE) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.02) + facet_wrap(.~factor(gene, levels = c("RPL7", "RPL7mut","FF", "RPS28", "RPS28mut")), nrow = 2) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 12)) + coord_cartesian(ylim = c(-0.02,0.45))

#CADsiRNAbyRP7n28

rbind(CADfilt_summary, filt_spot_summary) %>% filter(gene %in% c("RPL7"), !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"), siRNA != "none", cell == "soma") %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")), hide.ns = TRUE, method = "t.test", size = 5, label.y = c(0.25,0.3,0.35,0.4)) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE)  + facet_wrap(.~gene, nrow = 2, scales = "free_y") + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#e8c040")) + scale_alpha_manual(values = c(1,1)) + EnvStats::stat_n_text(y.pos = -0.01, size = 5) + coord_cartesian(ylim = c(-0.025,0.45))

rbind(CADfilt_summary, filt_spot_summary) %>% filter(gene %in% c("RPS28"), !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"), siRNA != "none", cell == "soma") %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")), hide.ns = TRUE, method = "t.test", size = 5, label.y = c(0.2,0.24,0.28,0.32)) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE)  + facet_wrap(.~gene, nrow = 2, scales = "free_y") + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#b82080")) + scale_alpha_manual(values = c(1,1)) + EnvStats::stat_n_text(y.pos = -0.01, size = 5) + coord_cartesian(ylim = c(-0.025,0.35))

#CADsiRNAbyControls

rbind(CADfilt_summary, filt_spot_summary) %>% filter(gene %in% c("FF"), !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"), siRNA != "none", cell == "soma") %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh))   + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")),label.y = c(0.1,0.125,0.15,0.175), hide.ns = TRUE, method = "t.test", size = 5) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#808080", "#e8c040", "#b82080")) + scale_alpha_manual(values = c(1)) + EnvStats::stat_n_text(y.pos = -0.01, size = 5) + coord_cartesian(ylim = c(-0.025,0.2))

rbind(CADfilt_summary, filt_spot_summary) %>% filter(gene %in% c("RPL7mut"), !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"), siRNA != "none", cell == "soma") %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh))   + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")),label.y = c(0.1,0.125,0.15,0.175), hide.ns = TRUE, method = "t.test", size = 5) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#e8c040")) + scale_alpha_manual(values = c(0.5,0.5)) + EnvStats::stat_n_text(y.pos = -0.01, size = 5) + coord_cartesian(ylim = c(-0.025,0.2))

rbind(CADfilt_summary, filt_spot_summary) %>% filter(gene %in% c( "RPS28mut"), !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"), siRNA != "none", cell == "soma") %>% select(-N_thres_Total) %>% unique() %>% ggplot(aes(x = siRNA, y = n_s_thresh))   + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Ssb"),c("NC1", "Larp1"), c("NC1", "Larp4"),c("NC1", "Larp7")),label.y = c(0.1,0.125,0.15,0.175), hide.ns = TRUE, method = "t.test", size = 5) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = FALSE, alpha = FALSE) + facet_wrap(.~gene, nrow = 3) + scale_x_discrete(limits = c("NC1", "Ssb", "Larp1", "Larp4", "Larp7")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#b82080")) + scale_alpha_manual(values = c(0.5,0.5)) + EnvStats::stat_n_text(y.pos = -0.01, size = 5) + coord_cartesian(ylim = c(-0.025,0.2))


## new plot
#!(gene == "RPS28mut" & siRNA == "Ssb" & image == "08"),
#!(gene == "FF" & siRNA == "Ssb" & image %in% c("01", "04"))


rbind(CADfilt_summary, filt_spot_summary) %>% 
  filter(#siRNA == "Larp7",
         !(gene == "RPL7mut" & siRNA == "NC1" & image == "01"),
         !(gene == "RPS28mut" & siRNA == "Ssb" & image %in% c("06", "01")),
         !(gene == "RPL7" & siRNA == "Ssb" & image %in% c("06", "07")),
         !(gene == "FF" & siRNA == "Ssb" & image %in% c("01", "04")),
         !(gene == "FF" & siRNA == "Larp4" & image %in% c("08", "02","03","07")),
         !(gene == "RPL7mut" & siRNA == "Larp4" & image %in% c("03","07")),
         !(gene == "RPS28" & siRNA == "Larp4" & image %in% c("02","09")),
         !(gene == "RPS28mut" & siRNA == "Larp4" & image %in% c("02","10")),
         !(gene == "FF" & siRNA == "Larp7" & image %in% c("01","02","11","05")),
         !(gene == "RPL7" & siRNA == "Larp7" & image %in% c("06","05")),
         !(gene == "RPS28" & siRNA == "Larp7" & image %in% c("04","07")),
         !(gene == "RPS28mut" & siRNA == "Larp7" & image %in% c("07","08")),
         siRNA != "none", 
         cell == "soma") %>% 
  select(-N_thres_Total) %>% 
  unique() %>% 
  ggplot(aes(x = gene, y = n_s_thresh))  + geom_violin(aes(fill = gene, alpha = gene)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA, width = 0.1) + theme_cowplot() + geom_point(aes(shape = image), size = 4, position = "jitter") + stat_compare_means(comparisons = list(c("RPL7", "RPL7mut"),c("FF", "RPL7"),c("FF","RPL7mut"),c("RPS28", "RPS28mut"),c("FF", "RPS28"),c("FF","RPS28mut")), label.y = c(0.2,0.25,0.3,0.25,0.35,0.4), method = "wilcox.test", size = 4) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma") + guides(fill = "none", alpha = "none") + EnvStats::stat_n_text(y.pos = -0.05) + facet_wrap(.~siRNA, nrow = 5) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15)) + scale_fill_manual(values = c("#808080", "#e8c040", "#e8c040", "#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + coord_cartesian(ylim = c(-0.07,0.45)) + scale_shape_manual(values = c(0,1,2,3,4,8,15,16,17,18,12,13))

```


```{r, playing with normalization}
NC1_neurite_mean_spots <- rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma") %>% filter(siRNA == "NC1") %>% group_by(gene) %>% summarise(meanNCspots = mean(numspots, na.rm = TRUE))

rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma") %>% spread(siRNA, numspots) %>% left_join(.,NC1_neurite_mean_spots, by = "gene") %>% mutate(NC1_norm = log2(NC1/meanNCspots), Larp1_norm = log2(Larp1/meanNCspots), Larp4_norm = log2(Larp4/meanNCspots), Larp7_norm = log2(Larp7/meanNCspots), Ssb_norm = log2(Ssb/meanNCspots)) %>% select(-Larp1,-Larp4,-Larp7,-NC1, -none, -Ssb,-meanNCspots) %>% gather(-gene,-image,-cell, key = siRNA, value = norm_numspots) %>% na.omit() %>% ggplot(aes(x = gene, y = norm_numspots, fill = gene,alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test", hide.ns = TRUE) + labs(x = "", y = "Reporter Transcripts\nin Neurite, normalized,log2") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -5) + facet_wrap(.~factor(siRNA, levels = c("Ssb_norm","Larp1_norm", "Larp4_norm", "Larp7_norm", "NC1_norm")), nrow = 3) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5))


NC1_n_s_mean_spots <- rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total,-cell) %>% unique() %>% filter(siRNA == "NC1") %>% group_by(gene) %>% summarise(meanNCns = mean(n_s_thresh, na.rm = TRUE))

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total,-cell) %>% unique() %>% group_by(gene,siRNA,image) %>% summarize(cellnum = c(1:n()), n_s_thresh) %>% spread(siRNA,n_s_thresh) %>% left_join(.,NC1_n_s_mean_spots, by = "gene") %>% mutate(NC1_norm = log2(NC1/meanNCns), Larp1_norm = log2(Larp1/meanNCns), Larp4_norm = log2(Larp4/meanNCns), Larp7_norm = log2(Larp7/meanNCns), Ssb_norm = log2(Ssb/meanNCns)) %>% select(-Larp1,-Larp4,-Larp7, -NC1, -none, -Ssb, -cellnum, -meanNCns) %>% gather(-gene,-image, key = siRNA, value = norm_n_s) %>% na.omit() %>% ggplot(aes(x = gene, y = norm_n_s, fill = gene,alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test", label.y = c(3,3.5,2.5,4,4.5,2.5)) + labs(x = "", y = "Reporter Transcripts\nin Neurite/Soma, normalized,log2") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -4) + facet_wrap(.~factor(siRNA, levels = c("Ssb_norm","Larp1_norm", "Larp4_norm", "Larp7_norm", "NC1_norm")), nrow = 3) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5))
```

```{r, just larp1}
rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA == "Larp1" | siRNA == "NC1") %>% ggplot(aes(x = gene, y = numspots, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")),label = "p.signif",label.y = c(100,110,90,120,130,90), size = 5, method = "wilcox.test") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -5) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_grid(.~siRNA) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5))

rbind(CAD_filt, filt_spot_28) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma",gene != "FF", siRNA == "Larp1" | siRNA == "NC1") %>% ggplot(aes(x = gene, y = numspots, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("RPL7", "RPL7mut"),c("RPS28", "RPS28mut")),label = "p.signif",label.y = c(90,90), method = "wilcox.test", size = 5) + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -5) + scale_x_discrete(limits = c( "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_grid(.~siRNA) + scale_fill_manual(values = c("#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,0.5,1,0.5))

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA == "Larp1" | siRNA == "NC1") %>% ggplot(aes(x = gene, y = n_s_thresh, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")),label.y = c(0.175,0.190,0.160,0.205,0.220,0.160), method = "wilcox.test", size = 5, hide.ns = TRUE) + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.01) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_grid(.~siRNA) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma",gene != "FF", siRNA == "Larp1" | siRNA == "NC1") %>% ggplot(aes(x = gene, y = n_s_thresh, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("RPL7", "RPL7mut"),c("RPS28", "RPS28mut")),label = "p.signif",label.y = c(0.175,0.175), method = "wilcox.test", size = 5) + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.05) + scale_x_discrete(limits = c( "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_grid(.~siRNA) + scale_fill_manual(values = c("#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,0.5,1,0.5))

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA %in% c("Larp1", "NC1")) %>% na.omit() %>% ggplot(aes(x = siRNA, y = n_s_thresh)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1")), method = "wilcox.test", size = 5, hide.ns = TRUE, label.y = c(0.15)) + labs(x = "", y = "Reporter Transcripts\nin Neurite/ Soma") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.01) + facet_wrap(.~gene)  + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

## check for weirdos
rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA %in% c("Larp1", "NC1")) %>% na.omit() %>% ggplot(aes(x = image, y = n_s_thresh)) + geom_point(size = 3) + facet_grid(gene~siRNA) + coord_cartesian(ylim = c(0,0.2))

rbind(CAD_filt, filt_spot_28) %>% filter(!(gene == "RPL7mut" & siRNA == "NC1" & image == "01")) %>% mutate(Cell =as.numeric(substr(Cell,6,6)), Cell = ifelse(Cell %%2 == 0, Cell-1,Cell)) %>%  group_by(gene,siRNA,image,cell,Cell) %>% summarize(numspots = n()) %>% filter(cell == "soma", siRNA %in% c("Larp1", "NC1")) %>% na.omit() %>% ggplot(aes(x = siRNA, y = numspots)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1")), method = "wilcox.test", size = 5, label.y = c(100), label = "p.signif") + labs(x = "", y = "Reporter Transcripts\nin Neurite") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -8) + facet_wrap(.~gene, nrow = 1)  + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

rbind(CADfilt_summary, filt_spot_summary) %>% filter(!(gene == "RPL7mut" & siRNA == "NC1" & image == "01")) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA %in% c("Larp1", "NC1")) %>% na.omit() %>% ggplot(aes(x = siRNA, y = n_s_thresh)) + geom_boxplot(aes(fill = gene, alpha = gene),outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("NC1", "Larp1")), method = "t.test", size = 7, label.y = c(0.2), label="p.signif", hide.ns = TRUE, vjust = 0.5) + labs(x = "", y = "Reporter Transcripts\nin Neurite/ Soma") + guides(fill = FALSE, alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.01, size = 4) + facet_wrap(.~gene, nrow = 1)  + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + scale_x_discrete(limits = c("NC1","Larp1"), labels = c("NC", "Larp1")) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

```


```{r, plots}
rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA == "Larp1") %>% ggplot(aes(x = gene, y = n_s_thresh, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")),label.y = c(0.12,0.14,0.10,0.16,0.18,0.10), method = "wilcox.test", size = 5, hide.ns = TRUE) + labs(x = "", y = "Reporter Transcripts\nin Neurite/ Soma") + guides(fill = FALSE,alpha = FALSE) + EnvStats::stat_n_text(y.pos = -0.01) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_grid(.~siRNA) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

rbind(CADfilt_summary, filt_spot_summary) %>% select(-N_thres_Total) %>% unique() %>% filter(cell == "soma", siRNA != "Larp1", siRNA != "none") %>% na.omit() %>% ggplot(aes(x = gene, y = n_s_thresh, fill = gene, alpha = gene)) + geom_boxplot(outlier.shape = NA) + theme_cowplot() + stat_compare_means(comparisons = list(c("FF", "RPL7"), c("FF", "RPL7mut"), c("RPL7", "RPL7mut"), c("FF", "RPS28"), c("FF", "RPS28mut"), c("RPS28", "RPS28mut")), method = "wilcox.test", size = 7, label = "p.signif", hide.ns = TRUE,vjust = 0.5, label.y = c(0.175,0.225,0.160,0.275,0.325,0.160)) + labs(x = "", y = "Reporter Transcripts\nin Neurite/ Soma") + guides(fill = "none",alpha = "none") + EnvStats::stat_n_text(y.pos = -0.05) + scale_x_discrete(limits = c("FF", "RPL7", "RPL7mut", "RPS28", "RPS28mut")) + facet_wrap(.~factor(siRNA, levels = c("NC1", "Ssb", "Larp4", "Larp7")), nrow = 2) + scale_fill_manual(values = c("#808080","#e8c040", "#e8c040","#b82080", "#b82080")) + scale_alpha_manual(values = c(1,1,0.5,1,0.5)) + theme(strip.background = element_rect(color = "white", fill = "white")) + theme(text = element_text(size=15), axis.text = element_text(size = 15))

```



